# README

Приложение "Placeholder_ftp" выполняет преобразования файлов сетевого трафика в текстовый формат по анаологии с TShark.
Выполняет действия в следующем порядке:

1. Принимает команду в виде JSON объекта, структура JSON объекта подробно описана ниже, через брокер сообщения NATS.
2. Забирает по указанному пути с локального ftp сервера, pcap файл, с фрагментом сетевого трафика.
3. Преобразует полученный pcap файл в текстовый формат, результат преобразования похож на файл полученный в результате
   обработки файла pcap программой TShark.
4. Отправляет полученный текстовый файл на ftp сервер-агрегатор по заданному в полученном JSON пути.
5. Отправляет JSON объект с ответом инициатору запроса.

## Конфигурационные настройки

Конфигурационные параметры для сервиса могут быть заданы как через конфигурационный файл так и методом установки переменных окружения. Однако, все пароли и
ключевые токены, используемые для авторизации, задаются ТОЛЬКО через переменные окружения.

#### Типы конфигурационных файлов:

- config.yaml общий конфигурационный файл
- config_dev.yaml конфигурационный файл используемый для тестов при разработке
- config_prod.yaml конфигурационный файл применяемый в продуктовом режиме

Основная переменная окружения для данного приложения - GO_PHFTP_MAIN. На основании значения этой переменной принимается решение какой из конфигурационных файлов config_dev.yaml или config_prod.yaml использовать. При GO_PHFTP_MAIN=development будет использоваться config_dev.yaml, во всех остальных случаях, в том числе и при отсутствии переменной окружения GO_PHFTP_MAIN будет использоваться конфигурационный файл config_prod.yaml. Перечень переменных окружения которые можно использовать для настройки приложения:

#### Переменная окружения отвечающая за тип запуска приложения "test", "development" или "production"

GO_PHFTP_MAIN

#### Переменные окружения отвечающие за подключение к NATS

GO_PHFTP_NPREFIX
GO_PHFTP_NHOST
GO_PHFTP_NPORT
GO_PHFTP_NCACHETTL - данный параметр должен содержать время жизни записи
кэша, по истечение которого запись автоматически удаляется, значение задается
в секундах в диапазоне от 10 до 86400 секунд
GO_PHFTP_NSUBLISTENERCOMMAND - канал для приема команд

#### Переменные окружения отвечающие за подключение к локальному FTP сервреру

GO_PHFTP_LOCALFTP_HOST
GO_PHFTP_LOCALFTP_USERNAME
GO_PHFTP_LOCALFTP_PASSWD

#### Переменные окружения отвечающие за подключение к FTP сервреру агрегатору файлов

GO_PHFTP_MAINFTP_HOST
GO_PHFTP_MAINFTP_USERNAME
GO_PHFTP_MAINFTP_PASSWD

## Структура JSON запроса

```
{
    task_id: "" //идентификатор задачи
    service: "" //имя сервиса-инициатора команды
    command: "" //наименование команды
    parameters: {
      path_local_ftp: "" //путь к папке на локальном ftp сервере
      path_main_ftp: "" //путь к целевой папке на ftp сервере-агрегаторе
      files: [] //список файлов которые необходимо обработать
    }
}
```

Выполняются следующие типы команд:

- 'copy_file' просто выполняет копирование файла с одного ftp сервера на другой
- 'convert_and_copy_file' выполняется конвертирование pcap файла в текст и копирование с одного ftp сервера на другой

## Структура JSON ответа

```
{
    task_id: "" //идентификатор задачи
    error: "" //содержит глобальные ошибки, такие как например, ошибка подключения к ftp серверу
    processed_command: "" //обработанная команда
    parameters: {
      processed_files: [
        {
          file_name: "" //имя файла
          error: "" //ошибка возникшая при обработки файла
          size_befor_processing: int //размер файла до обработки
          size_after_processing: int //размер файла после обработки
        }
      ]
    }
}
```
